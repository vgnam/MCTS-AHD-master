import random
import math

def select_next_node(current_node, destination_node, unvisited_nodes, distance_matrix, temperature=100, recent_visits=None):
    if recent_visits is None:
        recent_visits = {}
    
    if not unvisited_nodes:
        return destination_node
    
    distances = {node: distance_matrix[current_node][node] for node in unvisited_nodes}
    destination_distance = distance_matrix[current_node][destination_node] if destination_node in unvisited_nodes else float('inf')
    min_distance = min(distances.values())
    closest_nodes = [node for node, distance in distances.items() if distance <= min_distance * 1.2]
    
    scores = {}
    for node in closest_nodes:
        distance_score = 1 / distances[node]
        destination_bonus = 1.5 if node == destination_node else 1
        visit_penalty = 0.5 ** recent_visits.get(node, 0)
        score = distance_score * destination_bonus * visit_penalty
        scores[node] = score
    
    total_score = sum(scores.values())
    probabilities = {node: score / total_score for node, score in scores.items()}
    
    next_node = random.choices(list(probabilities.keys()), weights=probabilities.values(), k=1)[0]
    
    if destination_distance < distances[next_node]:
        next_node = destination_node
    
    # Update recent visits
    recent_visits[current_node] = recent_visits.get(current_node, 0) + 1
    
    # Decrease temperature
    temperature *= 0.99
    
    return next_node
